{{!--
  Copyright 2016, Yahoo Inc.
  Licensed under the terms of the Apache License, Version 2.0.
  See the LICENSE file associated with the project for terms.
 --}}
<div class="query-panel {{if this.isListening "query-running"}}">

  <div class="validation-container">
    {{#if this.hasError}}
      <div {{did-insert this.scrollIntoView}} />
      <SimpleAlert @type="error">
        <span>OOPS! PLEASE FIX ALL ERRORS TO PROCEED</span>
        <ul class="error-list">
          {{#each (get this.query 'validations.messages') as |message|}}
            <li>{{message}}</li>
          {{/each}}
        </ul>
      </SimpleAlert>
    {{else if this.hasSaved}}
      <div {{did-insert this.scrollIntoView}} />
      <SimpleAlert @type="success">
        <span>SAVED TO BROWSER CACHE!</span>
      </SimpleAlert>
    {{/if}}
  </div>

  <div class="scrollable-panel">

    <div class="container-fluid name-container">
      <div class="col-xs-12 query-name">
        <LabeledInput @fieldName="Name" @placeholder="Name Your Query" @fieldValue={{this.query.name}}
                      @disabled={{this.isListening}} @maxlength={{80}} />
      </div>
    </div>

    <div class="container-fluid filter-container">
      <div class="section-header">
        <h3 class="section-title">Filters</h3>
        <InfoPopover @title="Filters">
          {{partial "partials/filter-help"}}
        </InfoPopover>
      </div>
      <div class="{{this.queryBuilderClass}}" {{did-insert this.addQueryBuilder this.queryBuilderOptions}}/>
    </div>


    <div class="container-fluid output-container">
      <div class="section-header">
        <h3 class="section-title">Output Data</h3>
        <InfoPopover @title="Output Data">
          {{partial "partials/output-data-help"}}
        </InfoPopover>
      </div>

      <OutputDataInput @subfieldSuffix={{this.subfieldSuffix}} @subfieldSeparator={{this.subfieldSeparator}} @query={{this.query}}
                       @forceDirty={{this.hasError}} @disabled={{this.isListening}} @columns={{this.columns}} />
    </div>

    <div class="container-fluid window-container">
      <div class="section-header">
        <h3 class="section-title">Windowing</h3>
        <InfoPopover @title="Window">
          {{partial "partials/window-help"}}
        </InfoPopover>
      </div>

      <WindowInput @query={{this.query}} @disabled={{this.isListening}} />
    </div>


    <div class="container-fluid options-container">
      <div class="section-header">
        <h3 class="section-title">Query Stop Criteria</h3>
        <InfoPopover @title="Query Stop Criteria">
          {{partial "partials/options-help"}}
        </InfoPopover>
      </div>

      <div class="row">
        {{#if this.showAggregationSize}}
          <ValidatedInput @inputClassNames="col-xs-2 aggregation-size" @model={{this.query.aggregation}} @valuePath="size"
                          @fieldName="Maximum Result Count" @type="number" @placeholder="Number" @disabled={{this.isListening}} />
        {{/if}}
        <ValidatedInput @inputClassNames="col-xs-2 query-duration" @model={{this.query}} @valuePath="duration"
                        @fieldName="Maximum Duration (seconds)" @type="number" @placeholder="Number" @disabled={{this.isListening}} />
      </div>
    </div>

  </div>

  <div class="container-fluid control-container">
    <hr />
    <button type="button" class="btn btn-primary btn-md submit-button" {{on "click" this.listen}}>Run Query</button>
    <button type="button" class="btn btn-default btn-md save-button" {{on "click" this.save}}>Save Query</button>
  </div>


</div>
